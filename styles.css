/* ---
  Material Design 3 Overhaul (Final)
  - Includes dark mode, shadows, and all layout refinements.
--- */

/* --- M3 Color System & Shape Tokens --- */
:root {
  /* Light Theme (Default) */
  --m3-sys-color-primary: #005DB3;
  --m3-sys-color-on-primary: #FFFFFF;
  --m3-sys-color-primary-container: #D6E3FF;
  --m3-sys-color-on-primary-container: #001C3B;
  --m3-sys-color-secondary: #FF8D00;
  --m3-sys-color-on-secondary: #FFFFFF;
  --m3-sys-color-secondary-container: #FFE1C0;
  --m3-sys-color-on-secondary-container: #2A1800;
  --m3-sys-color-surface: #FCFCFF;
  --m3-sys-color-on-surface: #1A1C1E;
  --m3-sys-color-surface-variant: #E0E2EC;
  --m3-sys-color-on-surface-variant: #43474E;
  --m3-sys-color-surface-dim: #f5f5f5; /* For hidden items */
  --m3-sys-color-background: #F4F4F7;
  --m3-sys-color-on-background: #1A1C1E;
  --m3-sys-color-error: #B3261E;
  --m3-sys-color-on-error: #FFFFFF;
  --m3-sys-color-outline: #74777F;
  --m3-sys-color-shadow: #000000;
  --m3-sys-color-success: #28a745;
  
  --m3-state-layer-hover-opacity: 0.08;
  --m3-state-layer-focus-opacity: 0.12;
  --m3-state-layer-pressed-opacity: 0.12;

  --m3-shape-corner-xs: 4px;
  --m3-shape-corner-sm: 8px;
  --m3-shape-corner-md: 12px;
  --m3-shape-corner-lg: 16px;
  --m3-shape-corner-xl: 28px;
  --m3-shape-corner-full: 100px;
  
  --m3-gutter-mobile: 16px;
}

/* Dark Mode Theme */
@media (prefers-color-scheme: dark) {
  :root {
    --m3-sys-color-primary: #A8C7FA;
    --m3-sys-color-on-primary: #003062;
    --m3-sys-color-primary-container: #004787;
    --m3-sys-color-on-primary-container: #D6E3FF;
    --m3-sys-color-secondary: #FFB77C;
    --m3-sys-color-on-secondary: #462A00;
    --m3-sys-color-secondary-container: #643E00;
    --m3-sys-color-on-secondary-container: #FFE1C0;
    --m3-sys-color-surface: #1A1C1E;
    --m3-sys-color-on-surface: #E3E2E6;
    --m3-sys-color-surface-variant: #43474E;
    --m3-sys-color-on-surface-variant: #C4C6CF;
    --m3-sys-color-surface-dim: #2d2d2d;
    --m3-sys-color-background: #121417;
    --m3-sys-color-on-background: #E3E2E6;
    --m3-sys-color-error: #F2B8B5;
    --m3-sys-color-on-error: #601410;
    --m3-sys-color-outline: #8E9099;
  }
}

/* --- M3 Base & Custom Typography --- */
html {
  font-size: 16px; /* Desktop baseline */
}

body {
  font-family: 'Lato', sans-serif;
  margin: 0;
  background-color: var(--m3-sys-color-background);
  color: var(--m3-sys-color-on-surface);
}

h1, h2, h3 {
  font-family: 'Average', serif;
}

/* --- Layout & Sections --- */
.container {
  max-width: 700px;
  margin: 0 auto; 
  padding: 0;
}

h1 { 
  font-size: 2.2rem;
  font-weight: 400;
  line-height: 2.7rem;
  color: var(--m3-sys-color-primary);
  text-align: center;
  margin: 0;
  padding: 24px var(--m3-gutter-mobile);
}

h2 {
  font-size: 1.5rem;
  font-weight: 400;
  line-height: 1.75rem;
  color: var(--m3-sys-color-on-surface);
}

h3 {
  font-size: 1.1rem;
  font-weight: 400;
  line-height: 1.5rem;
  color: var(--m3-sys-color-on-surface);
}

label {
  font-size: 0.875rem;
  font-weight: 700;
  line-height: 1.25rem;
  color: var(--m3-sys-color-on-surface-variant);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.section, .report-section {
  background-color: var(--m3-sys-color-surface);
  padding: var(--m3-gutter-mobile);
  margin: 0 0 24px 0;
  border: 1px solid var(--m3-sys-color-surface-variant);
  box-shadow: 0 2px 4px rgba(var(--m3-sys-color-shadow), 0.08);
}

/* --- Media Queries for Mobile & Desktop --- */

@media (min-width: 732px) {
  .container {
    padding: 24px 0;
  }
  .section, .report-section {
    border-radius: var(--m3-shape-corner-lg);
    padding: 16px;
  }
  h1 {
    padding: 0;
    margin-bottom: 24px;
  }
}

@media (max-width: 767px) {
  .section, .report-section {
    border-radius: 0;
    border-left: none;
    border-right: none;
  }
  html {
    font-size: 20px;
  }
  h1 { font-size: 2.1rem; }
  h2 { font-size: 1.4rem; }
  .search-result-item,
  input[type="text"], 
  textarea {
    font-size: 1.1rem;
  }
  button:not(.icon-button) {
      padding: 18px 24px;
      font-size: 1.1rem;
  }
  .observation-text {
    font-size: 1.1rem;
    line-height: 1.6;
  }
  #selected-goal-display p {
      font-size: 1rem;
  }
}

/* --- Component & Module Styles --- */

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  gap: 16px;
}
.section-header h2 {
  flex-grow: 1;
  padding: 0;
  margin: 0;
}
.report-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.sort-controls { display: flex; gap: 4px; }
.icon-button {
  background-color: transparent;
  color: var(--m3-sys-color-on-surface-variant);
  width: 44px; height: 44px; padding: 10px;
  box-sizing: border-box; vertical-align: middle;
  border-radius: var(--m3-shape-corner-full);
  border: none; position: relative; overflow: hidden;
  cursor: pointer; display: inline-flex;
  align-items: center; justify-content: center;
}
.icon-button.active {
  background-color: var(--m3-sys-color-primary-container);
  color: var(--m3-sys-color-on-primary-container);
}
.icon-button::before {
  content: ""; position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: var(--m3-sys-color-on-surface);
  opacity: 0; transition: opacity 0.2s;
}
.icon-button:hover::before { opacity: var(--m3-state-layer-hover-opacity); }

.input-with-button {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-bottom: 16px;
}
.input-with-button input {
  flex-grow: 1;
  margin-bottom: 0;
}
.input-with-button button {
  flex-shrink: 0;
}

input[type="text"], textarea {
  background-color: var(--m3-sys-color-surface-variant);
  color: var(--m3-sys-color-on-surface);
  padding: 20px 16px;
  min-height: 60px;
  box-sizing: border-box; 
  border: none;
  border-bottom: 1px solid var(--m3-sys-color-on-surface-variant);
  border-radius: var(--m3-shape-corner-xs) var(--m3-shape-corner-xs) 0 0;
  transition: border-bottom 0.2s ease;
  font-family: 'Lato', sans-serif;
}
textarea {
  width: 100%;
  margin-bottom: 16px;
}
input[type="text"]:focus, textarea:focus { outline: none; border-bottom: 2px solid var(--m3-sys-color-primary); }
input[type="text"]::placeholder, textarea::placeholder { color: var(--m3-sys-color-on-surface-variant); }

button {
  position: relative; overflow: hidden; border: none;
  border-radius: var(--m3-shape-corner-full); padding: 10px 24px;
  font-weight: 700; cursor: pointer;
  transition: box-shadow 0.2s, background-color 0.2s;
  text-align: center; display: inline-flex;
  align-items: center; justify-content: center;
  gap: 8px; font-family: 'Lato', sans-serif;
}
button:not(.icon-button)::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--m3-sys-color-on-primary); opacity: 0; transition: opacity 0.2s; }
button:not(.icon-button):hover::before { opacity: var(--m3-state-layer-hover-opacity); }
button:not(.icon-button):focus::before { opacity: var(--m3-state-layer-focus-opacity); }
button:disabled { background-color: rgba(26, 28, 30, 0.12); color: rgba(26, 28, 30, 0.38); box-shadow: none; cursor: not-allowed; }
button:disabled::before { display: none; }
#submitObservationBtn, .save-btn { background-color: var(--m3-sys-color-primary); color: var(--m3-sys-color-on-primary); }
.cancel-btn { background-color: transparent; color: var(--m3-sys-color-primary); }
.cancel-btn::before { background-color: var(--m3-sys-color-primary); }
.text-button { background-color: transparent; color: var(--m3-sys-color-primary); }
.text-button::before { background-color: var(--m3-sys-color-primary); }

#student-search-results { border: 1px solid var(--m3-sys-color-outline); border-radius: var(--m3-shape-corner-md); margin: 0; max-height: 250px; overflow-y: auto; }
.search-result-item { padding: 16px; cursor: pointer; border-bottom: 1px solid var(--m3-sys-color-surface-variant); }
.search-result-item:last-child { border-bottom: none; }
.search-result-item:hover { background-color: rgba(0, 93, 179, var(--m3-state-layer-hover-opacity)); }
.search-result-item.inactive { color: var(--m3-sys-color-outline); font-style: italic; }
#selected-student-display { background-color: var(--m3-sys-color-primary-container); color: var(--m3-sys-color-on-primary-container); border-radius: var(--m3-shape-corner-sm); padding: 8px 16px; margin-top: 16px; text-align: center; font-weight: 700; }

.goal-button-container { display: flex; flex-wrap: wrap; gap: 8px; }
.goal-button { flex-grow: 1; background-color: transparent; border: 1px solid var(--goal-color, var(--m3-sys-color-outline)); color: var(--goal-color, var(--m3-sys-color-on-surface-variant)); transition: background-color 0.2s, color 0.2s; }
.goal-button:hover { background-color: var(--goal-color, var(--m3-sys-color-surface-variant)); color: white; }
.goal-button.selected { background-color: var(--goal-color, var(--m3-sys-color-secondary-container)); color: #FFFFFF; border-color: var(--goal-color, var(--m3-sys-color-secondary-container)); }
#selected-goal-display { margin-top: 16px; padding: 12px; border-radius: var(--m3-shape-corner-md); background-color: var(--m3-sys-color-surface-variant); }

.modal-overlay { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(26, 28, 30, 0.4); justify-content: center; align-items: center; overflow-y: auto; }
.modal-content { background-color: var(--m3-sys-color-surface); border-radius: var(--m3-shape-corner-xl); padding: 24px; width: 90%; max-width: 500px; box-shadow: 0 4px 16px rgba(var(--m3-sys-color-shadow), 0.2); }
.modal-content h3 { margin: 0 0 16px 0; color: var(--m3-sys-color-on-surface); }
.modal-form-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 24px; }

.form-group { margin-bottom: 16px; }
.radio-group, .checkbox-group { display: flex; gap: 16px; align-items: center; margin-top: 8px; }
.radio-group label, .checkbox-group label { text-transform: none; letter-spacing: normal; font-weight: 400; }

.toggle-switch-container { display: flex; align-items: center; gap: 8px; cursor: pointer; }
.toggle-switch-container label:first-child { font-size: 0.8rem; color: var(--m3-sys-color-on-surface-variant); font-weight: 500; }
.toggle-switch { position: relative; display: inline-block; width: 38px; height: 22px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--m3-sys-color-outline); transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--m3-sys-color-primary); }
input:checked + .slider:before { transform: translateX(16px); }

#tag-selection-container { margin-bottom: 16px; }
.tag-chips-area { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.tag-chip { padding: 8px 16px; border-radius: var(--m3-shape-corner-sm); background-color: var(--m3-sys-color-surface-variant); color: var(--m3-sys-color-on-surface-variant); cursor: pointer; transition: background-color 0.2s, color 0.2s; font-size: 0.9rem; border: 1px solid transparent; }
.tag-chip:hover { background-color: var(--m3-sys-color-primary-container); }
.tag-chip.selected { background-color: var(--m3-sys-color-primary); color: var(--m3-sys-color-on-primary); font-weight: 700; }
.tag-chip.control-chip { background-color: transparent; border: 1px dashed var(--m3-sys-color-outline); color: var(--m3-sys-color-outline); }
.form-helper-text { font-size: 0.75rem; font-style: italic; color: var(--m3-sys-color-on-surface-variant); margin-top: 4px; }

#report-tag-summary { margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--m3-sys-color-surface-variant); }
.summary-tag-item { background-color: var(--m3-sys-color-secondary-container); color: var(--m3-sys-color-on-secondary-container); }
.summary-tag-item .tag-count { margin-left: 8px; background-color: var(--m3-sys-color-on-secondary-container); color: var(--m3-sys-color-secondary-container); padding: 2px 6px; border-radius: 10px; font-size: 0.8rem; font-weight: 700; }
.summary-tag-item.filtered { box-shadow: 0 0 0 2px var(--m3-sys-color-secondary); }

.report-group { background-color: rgba(0,0,0,0.02); border-radius: var(--m3-shape-corner-lg); padding: 16px var(--m3-gutter-mobile); margin-bottom: 24px; border: 1px solid transparent; }
.report-group-header { margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid var(--m3-sys-color-surface-variant); }
.report-group-header h3 { margin: 0; }
.goal-description-header { display: block; margin-top: 4px; font-size: 0.9rem; font-style: italic; color: var(--m3-sys-color-on-surface-variant); font-family: 'Lato', sans-serif; }
.report-entry { background-color: var(--m3-sys-color-surface); border: 1px solid var(--m3-sys-color-outline); border-radius: var(--m3-shape-corner-md); padding: 16px; margin-bottom: 12px; position: relative; display: flex; flex-direction: column; }
.report-entry.hidden-from-report { display: none; }
.report-section.is-showing-hidden .report-entry.hidden-from-report { display: flex; background-color: var(--m3-sys-color-surface-dim); border-style: dashed; border-color: var(--m3-sys-color-outline); }
.report-entry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.timestamp-line { font-size: 0.75rem; color: var(--m3-sys-color-on-surface-variant); display: flex; align-items: center; gap: 8px; margin-bottom: 0; }
.teacher-initials { background-color: var(--m3-sys-color-primary-container); color: var(--m3-sys-color-on-primary-container); font-weight: 700; border-radius: var(--m3-shape-corner-full); padding: 2px 8px; font-size: 0.7rem; }
.observation-text { line-height: 1.4; color: var(--m3-sys-color-on-surface); }
.report-entry-tags { margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px; }
.report-entry-tag { font-size: 0.75rem; padding: 2px 8px; border-radius: var(--m3-shape-corner-xs); background-color: var(--m3-sys-color-surface-variant); color: var(--m3-sys-color-on-surface-variant); }

.options-button.icon-button { width: 32px; height: 32px; padding: 4px; }
.options-button.icon-button .material-symbols-outlined { font-size: 20px; }
.add-edit-goal-icon { font-size: 1.5rem; }
.options-menu { display: none; position: absolute; background-color: var(--m3-sys-color-surface); border-radius: var(--m3-shape-corner-xs); box-shadow: 0 2px 8px rgba(var(--m3-sys-color-shadow), 0.2); z-index: 10; top: 48px; right: 16px; width: 200px; padding: 8px 0; flex-direction: column; align-items: stretch; }
.options-menu button { width: 100%; border-radius: 0; background-color: transparent; color: var(--m3-sys-color-on-surface); justify-content: flex-start; padding: 12px 16px; }
.options-menu button.delete-button { color: var(--m3-sys-color-error); }
.options-menu button::before { background-color: var(--m3-sys-color-on-surface); }
.options-menu button.delete-button::before { background-color: var(--m3-sys-color-error); }
.toggle-visibility-button { margin-top: 16px; background-color: var(--m3-sys-color-surface-variant); color: var(--m3-sys-color-on-surface-variant); }

.pdf-rendering-mode { --m3-sys-color-primary: #005DB3; --m3-sys-color-on-primary: #FFFFFF; --m3-sys-color-primary-container: #D6E3FF; --m3-sys-color-on-primary-container: #001C3B; --m3-sys-color-secondary: #FF8D00; --m3-sys-color-on-secondary: #FFFFFF; --m3-sys-color-secondary-container: #FFE1C0; --m3-sys-color-on-secondary-container: #2A1800; --m3-sys-color-surface: #FFFFFF; --m3-sys-color-on-surface: #1A1C1E; --m3-sys-color-surface-variant: #E0E2EC; --m3-sys-color-on-surface-variant: #43474E; --m3-sys-color-background: #FFFFFF; --m3-sys-color-on-background: #1A1C1E; --m3-sys-color-outline: #74777F; }
.pdf-rendering-mode body { font-size: 10pt; line-height: 1.3; }
.pdf-rendering-mode .section, .pdf-rendering-mode .report-entry { border: 1px solid #ccc; box-shadow: none; }
.pdf-rendering-mode .report-entry.hidden-from-report { display: none !important; }
.pdf-rendering-mode .options-button, .pdf-rendering-mode .options-menu,
.pdf-rendering-mode #edit-student-btn, .pdf-rendering-mode #studentSearch,
.pdf-rendering-mode label[for="studentSearch"], .pdf-rendering-mode .sort-controls,
.pdf-rendering-mode .toggle-switch-container,
.pdf-rendering-mode .report-actions,
.pdf-rendering-mode #observation-section,
.pdf-rendering-mode #goals-section { display: none !important; }
</style>
